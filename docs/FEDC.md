# Front-End Data Contracts (FEDC)

## Scope
This document captures the data that the current UI components expect so backend contracts can be designed with confidence. It covers:
- `src/components/parkSubmission/features/dashboard/ParkSubmissionAdminDashboard.jsx` and its nested moderation viewer (`ParkSubmissionViewer.jsx`)
- `src/hooks/MapLibre Hooks/useMapHelpers.jsx`
- `src/components/events/EventsBoard.jsx`

All timestamps should be ISO-8601 strings (UTC). IDs are opaque strings generated by the backend. Unless otherwise stated, arrays return empty (`[]`) when no data exists.

## ParkSubmissionAdminDashboard.jsx
### Overview
The admin dashboard renders a paginated feed of park submissions, exposes moderation status badges, and opens a detail viewer with approve/deny/pending actions. The viewer (`ParkSubmissionViewer.jsx`) reuses the same submission object and expects full detail in one payload.

### Collection Feed
`GET /api/admin/park-submissions`

| Query Param | Type | Notes |
| --- | --- | --- |
| `status` | `string` | Optional; one of `pending`, `approved`, `rejected`, `all` (default `pending`). |
| `search` | `string` | Optional fuzzy match on title, submitter, or address. |
| `page` | `number` | Starts at `1`. If not provided, defaults to `1`. |
| `pageSize` | `number` | Optional; defaults to `20` if not provided. Maximum allowed is `100`. |

```json
{
  "data": [
    {
      "id": "SUB-10342",
      "title": "Bayview Fitness Parc",
      "description": "Waterfront calisthenics spot featuring multiple rigs and sunrise views over the bay.",
      "address": "842 Marina Vista, San Francisco, CA 94109",
      "equipment": ["Pull-up Bars", "Dip Bars", "Push-up Bars"],
      "images": ["https://cdn.example.com/submissions/SUB-10342/1.jpg"],
      "submittedAt": "2024-08-24T15:36:00Z",
      "submitter": "dcitrus4",
      "moderationComment": "",
      "status": "pending"
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "totalPages": 8,
    "totalItems": 152
  }
}
```

### Submission Detail Viewer
The dashboard currently searches within the already-loaded submissions. To avoid stale data, prefer loading a fresh record before opening the viewer.

`GET /api/admin/park-submissions/{submissionId}`

```json
{
  "id": "SUB-10342",
  "title": "Bayview Fitness Parc",
  "parkName": "Bayview Fitness Parc",
  "description": "Waterfront calisthenics spot featuring multiple rigs and sunrise views over the bay.",
  "parkDescription": null,
  "address": "842 Marina Vista, San Francisco, CA 94109",
  "parkAddress": null,
  "equipment": ["Pull-up Bars", "Dip Bars", "Push-up Bars"],
  "images": ["https://cdn.example.com/submissions/SUB-10342/1.jpg"],
  "submittedAt": "2024-08-24T15:36:00Z",
  "date": null,
  "submitter": "dcitrus4",
  "user": null,
  "moderationComment": "",
  "status": "pending"
}
```

Field handling:
- `title` or `parkName` populate the heading (viewer uses `title ?? parkName ?? 'Untitled Submission'`); provide both when possible.
- `description` or `parkDescription` supplies the body copy (viewer uses `description ?? parkDescription ?? 'No description provided.'`).
- `address` or `parkAddress` fills the address block (viewer uses `address ?? parkAddress`).
- `submitter` or `user` is shown under the timestamp (viewer uses `submitter ?? user`).
- `submittedAt` or `date` is used for the timestamp display (viewer uses `submittedAt ?? date`).
- `status` should stay lowercase (`pending`, `approved`, `rejected`) for badge logic.
- `images` array controls the carousel. Empty array `[]` if no images. Image URLs served by CDN should return HTTP 404 for missing files to trigger the fallback UI.

### Moderation Actions
Moderation is a single RESTful update on the submission resource. The endpoint returns the updated submission object (same shape as the detail response) so the UI can refresh instantly.

`PATCH /api/admin/park-submissions/{submissionId}`

Request body (status required; comment optional):
```json
{
  "status": "approved",
  "comment": "Looks great—double-check lighting schedule."
}
```

| Field | Type | Notes |
| --- | --- | --- |
| `status` | `string` | Required; one of `approved`, `rejected`, `pending`. |
| `comment` | `string` | Optional; moderation note. Empty string or omit if none. Backend trims whitespace. |

If no comment is provided, send empty string `""` or omit the field.

`DELETE /api/admin/park-submissions/{submissionId}`

Response: `204 No Content` on success. If the submission is already deleted, return `404 Not Found` (idempotent).

| Behavior | Notes |
| --- | --- |
| Comment optionality | Empty string is acceptable; backend should trim. |
| Idempotency | Repeating an action with the same resulting status returns `200` with the current record. |
| Audit | Consider capturing `moderatedBy` and `moderatedAt` for future UI expansion. |

### Status Reference
```
pending -> awaiting review
approved -> visible to end users
rejected -> remains in list for audit history
```

Invalid statuses must surface as `400` to keep UI messaging accurate.

## useMapHelpers.jsx
### Purpose
Provides a `getFeaturesWithinBounds` helper. When wired to the backend the hook should request GeoJSON features constrained by the map viewport.

### Bounding-Box Search
`GET /api/park`

| Query Param | Type | Notes |
| --- | --- | --- |
| `bbox` | `string` | Required; `west,south,east,north` (comma separated floats). Format: `minLon,minLat,maxLon,maxLat`. Example: `-122.5,37.7,-122.3,37.9`. |
| `equipment` | `string` | Optional comma-separated filter. Matches parks that have ANY of the listed equipment. Example: `"Pull Up Bars,Dip Bars"`. |
| `updatedSince` | `string` | Optional ISO-8601 timestamp for incremental updates. |

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "parkId": "PRK-0091",
        "name": "Eastshore Park",
        "address": "2930 Grand Ave, Oakland, CA 94610",
        "equipment": ["Pull Up Bars", "Dip Bars"],
        "lastUpdated": "2024-08-01T12:04:00Z"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [-122.24892, 37.80975]
      }
    }
  ]
}
```

Field requirements:
- `properties.name` (required): Used for marker popups and display.
- `properties.address` (required): Used for marker popups and display.
- `properties.equipment` (required): Array of equipment strings, used for marker popups and filtering. Empty array `[]` if no equipment.
- `properties.parkId` (optional but recommended): Unique identifier for the park, useful for tracking and future features.
- `properties.lastUpdated` (optional but recommended): ISO-8601 timestamp for incremental updates via `updatedSince` query param.

Implementation notes:
- Response must always be valid GeoJSON; empty results return an empty `features` array.
- Use `200` with an empty collection when the bbox covers no parks.
- If the bbox is malformed return `400` with a message (`{ "error": "Invalid bbox format" }`).
- Frontend debounces map panning to reduce request frequency; backend should implement rate limiting as needed.
- Coordinates in `geometry.coordinates` must be `[longitude, latitude]` (GeoJSON standard).

## EventsBoard.jsx
### Overview
Renders a list of nearby or curated events. The component works with the events passed via props or falls back to a default list, so the backend should supply the whole array.

### Events Feed
`GET /api/events`

| Query Param | Type | Notes |
| --- | --- | --- |
| `lat` / `lng` | `number` | Optional; must be provided together if used. Enable distance calculations for sorting/filtering. |
| `radius` | `number` | Optional; required if `lat`/`lng` provided. Unit: **miles**. |
| `limit` | `number` | Optional; defaults to `10` if not provided. |
| `fromDate` | `string` | Optional ISO-8601 timestamp; omit events before this date. |

```json
{
  "data": [
    {
      "id": "EVT-2401",
      "parkName": "Bayview Fitness Parc",
      "address": "842 Marina Vista, San Francisco, CA 94109",
      "distance": "0.8 mi away",
      "date": "2024-09-14",
      "time": "09:00",
      "description": "Community sunrise stretch and mobility circuit led by local trainers.",
      "host": "Bayview Movement Collective",
      "ctaLabel": "View event"
    }
  ]
}
```

Field requirements:
- `id` (required): Unique identifier for the event.
- `parkName` (required): Name of the park where the event takes place.
- `address` (required): Full address of the park/event location.
- `description` (optional): Event description text.
- `host` (optional): Name of the event host or organization.
- `date` (optional): ISO-8601 date format (YYYY-MM-DD). Frontend formats for display. If omitted, UI shows "Date TBA".
- `time` (optional): 24-hour format (HH:mm) in UTC. Frontend converts to local timezone. If omitted, only date is shown.
- `distance` (optional): Pre-formatted string (e.g., "0.8 mi away", "1.2 mi away"). Backend must format the distance value. Required if `lat`/`lng` query params were provided.
- `ctaLabel` (optional): Call-to-action button label. Defaults to `"View event"` when missing.

### Error Handling
- Empty collections should return `200` with `"data": []`. The component already prints “Check back soon!”.
- Validation failures (e.g., missing lat or lng when radius supplied) should return `400` with an `error` string.

---

## Implementation Summary

### ✅ Implemented Endpoints

#### 1. Parks (`GET /api/park`)
- **Status**: ✅ Implemented
- **Endpoint**: `GET /api/park` (with bounding box support via `/location` endpoint)
- **Note**: The FEDC specifies `bbox` query param format, but current implementation uses separate `min_latitude`, `max_latitude`, `min_longitude`, `max_longitude` params. Consider adding a `bbox` parser for compatibility.

#### 2. Events (`GET /api/events`)
- **Status**: ✅ Implemented
- **Endpoint**: `GET /api/events`
- **Features**: Location-based filtering (lat/lng/radius), date filtering, distance calculation
- **Required for**: `EventsBoard.jsx` component

#### 3. Admin Park Submissions (`/api/admin/park-submissions/*`)
- **Status**: ✅ Implemented
- **Endpoints**:
  - `GET /api/admin/park-submissions` (with pagination, search, status filtering)
  - `GET /api/admin/park-submissions/{submissionId}`
  - `PATCH /api/admin/park-submissions/{submissionId}` (body: `{ "status": "approved" | "rejected" | "pending", "comment"?: string }`)
  - `DELETE /api/admin/park-submissions/{submissionId}`
- **Required for**: `ParkSubmissionAdminDashboard.jsx` and `ParkSubmissionViewer.jsx` components

---
All endpoints specified in this document are now implemented and ready for use.
